<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Score Tracker</title>

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont;
      background: #f5f5f5;
      padding: 16px;
      max-width: 700px;
      margin: auto;
    }
    h1, h2 {
      text-align: center;
    }
    input, button, select {
      width: 100%;
      padding: 10px;
      margin: 6px 0;
      font-size: 16px;
    }
    button {
      background: #000;
      color: #fff;
      border: none;
      border-radius: 6px;
    }
    .round {
      background: #fff;
      padding: 12px;
      margin: 12px 0;
      border-radius: 8px;
    }
    .locked {
      opacity: 0.6;
      pointer-events: none;
    }
    .row {
      display: flex;
      gap: 8px;
    }
    .row input {
      flex: 1;
    }
  </style>
</head>
<body>

<h1>Score Tracker</h1>

<div id="setup">
  <h2>Game Setup</h2>

  <label>Correct Winner Claim (default -5)</label>
  <input type="number" id="correctValue" value="-5">

  <label>Incorrect Winner Claim (default +15)</label>
  <input type="number" id="incorrectValue" value="15">

  <label>Add Player</label>
  <div class="row">
    <input id="playerName" placeholder="Name">
    <button onclick="addPlayer()">Add</button>
  </div>

  <ul id="playerList"></ul>

  <button onclick="startGame()">Start Game</button>
</div>

<div id="game" style="display:none;">
  <h2 id="gameTitle"></h2>
  <div id="rounds"></div>
  <button onclick="nextRound()">Finish Round</button>
  <button onclick="saveGame()">Save Game</button>
  <button onclick="resetGame()">Reset</button>

  <h3>Load Previous Game</h3>
  <select id="loadSelect"></select>
  <button onclick="loadGame()">Load</button>
</div>

<script>
let players = [];
let rounds = [];
let currentRound = 0;
let gameId = null;
let correctClaim = -5;
let incorrectClaim = 15;

function addPlayer() {
  const name = document.getElementById("playerName").value.trim();
  if (!name) return;
  players.push({ name, total: 0 });
  document.getElementById("playerName").value = "";
  renderPlayers();
}

function renderPlayers() {
  const ul = document.getElementById("playerList");
  ul.innerHTML = "";
  players.forEach(p => {
    const li = document.createElement("li");
    li.textContent = p.name;
    ul.appendChild(li);
  });
}

function startGame() {
  if (players.length < 2) return;

  correctClaim = Number(document.getElementById("correctValue").value);
  incorrectClaim = Number(document.getElementById("incorrectValue").value);

  gameId = Date.now();
  currentRound = 0;
  rounds = [];

  document.getElementById("setup").style.display = "none";
  document.getElementById("game").style.display = "block";
  document.getElementById("gameTitle").textContent = `Game #${gameId}`;

  nextRound();
}

function nextRound() {
  if (rounds.length && !rounds[rounds.length - 1].completed) return;

  const round = {
    scores: players.map(() => ""),
    winner: null,
    totals: [],
    completed: false
  };
  rounds.push(round);
  currentRound = rounds.length - 1;
  renderRounds();
}

function renderRounds() {
  const container = document.getElementById("rounds");
  container.innerHTML = "";

  rounds.forEach((round, rIndex) => {
    const div = document.createElement("div");
    div.className = "round" + (round.completed ? " locked" : "");

    div.innerHTML = `<h3>Round ${rIndex + 1}</h3>`;

    players.forEach((p, i) => {
      div.innerHTML += `
        <label>${p.name}</label>
        <input type="number" value="${round.scores[i]}"
          ${round.completed ? "disabled" : ""}
          oninput="rounds[${rIndex}].scores[${i}] = this.value">
      `;
    });

    div.innerHTML += `
      <label>Winner Claim</label>
      <select ${round.completed ? "disabled" : ""}
        onchange="rounds[${rIndex}].winner = this.value">
        <option value="">Select</option>
        ${players.map((p,i)=>`<option value="${i}">${p.name}</option>`).join("")}
      </select>
    `;

    if (!round.completed) {
      const btn = document.createElement("button");
      btn.textContent = "Confirm Round";
      btn.onclick = () => confirmRound(rIndex);
      div.appendChild(btn);
    }

    if (round.completed) {
      div.innerHTML += `<p><strong>Totals:</strong></p>`;
      round.totals.forEach((t,i)=>{
        div.innerHTML += `<p>${players[i].name}: ${t}</p>`;
      });
    }

    container.appendChild(div);
  });
}

function confirmRound(rIndex) {
  const round = rounds[rIndex];
  if (round.scores.some(s => s === "") || round.winner === null) return;

  round.scores = round.scores.map(Number);

  players.forEach((p,i)=>{
    p.total += round.scores[i];
  });

  const min = Math.min(...players.map(p=>p.total));
  if (players[round.winner].total === min) {
    players[round.winner].total += correctClaim;
  } else {
    players[round.winner].total += incorrectClaim;
  }

  round.totals = players.map(p=>p.total);
  round.completed = true;

  renderRounds();
}

function saveGame() {
  localStorage.setItem(`game-${gameId}`, JSON.stringify({
    gameId, players, rounds, correctClaim, incorrectClaim
  }));
  updateLoadList();
}

function loadGame() {
  const key = document.getElementById("loadSelect").value;
  if (!key) return;
  const data = JSON.parse(localStorage.getItem(key));

  ({ gameId, players, rounds, correctClaim, incorrectClaim } = data);
  document.getElementById("setup").style.display = "none";
  document.getElementById("game").style.display = "block";
  document.getElementById("gameTitle").textContent = `Game #${gameId}`;
  renderRounds();
}

function updateLoadList() {
  const select = document.getElementById("loadSelect");
  select.innerHTML = "<option value=''>Select game</option>";
  Object.keys(localStorage)
    .filter(k => k.startsWith("game-"))
    .forEach(k=>{
      const opt = document.createElement("option");
      opt.value = k;
      opt.textContent = k;
      select.appendChild(opt);
    });
}

function resetGame() {
  location.reload();
}

updateLoadList();
</script>

</body>
</html>
